<!DOCTYPE html>
<html lang="id" class="h-full">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dashboard</title>

  <!-- Tema awal (hindari kedip) -->
  <script>
    (function(){
      try{
        const KEY='pref-theme';
        const saved=localStorage.getItem(KEY);
        const sys=window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
        const dark = saved ? saved==='dark' : sys;
        if(dark) document.documentElement.classList.add('dark');
      }catch(e){}
    })();
  </script>

  <!-- Font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode:'class',
      theme:{ extend:{
        fontFamily:{ inter:['Inter','ui-sans-serif','system-ui']},
        colors:{
          ink:{50:'#F6F7FB',100:'#EFF1F7',200:'#E6E8F0',300:'#D9DDE7',400:'#C5CAD9',500:'#99A0B2',600:'#6B7280',700:'#4B5563',800:'#2B2F3A',900:'#171A21'},
          primary:{50:'#F3F4FF',100:'#E8EAFF',200:'#D6D9FF',300:'#BABFFF',400:'#9BA2FF',500:'#7C84FF',600:'#6D5DFF',700:'#5946E0',800:'#4B3BBC',900:'#3C2F97'},
          success:{50:'#E9FBF1',500:'#16A34A'}, danger:{50:'#FDECEC',500:'#DC2626'}
        },
        boxShadow:{ card:'0 1px 0 0 rgba(16,24,40,0.04), 0 1px 2px 0 rgba(16,24,40,0.06)'},
        borderRadius:{ xl:'16px','2xl':'20px' }
      } }
    }
  </script>

  <!-- Icons & Chart.js -->
  <script src="https://unpkg.com/lucide@latest"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

  <style>
    html { color-scheme: light dark; }
    body { font-family: Inter, ui-sans-serif, system-ui; }
    * { transition: background-color .3s ease, color .3s ease, border-color .3s ease, fill .3s ease, stroke .3s ease; }
    .kbd{ border:1px solid rgba(0,0,0,.08); background:#fff; box-shadow:0 1px 0 rgba(0,0,0,.04) }
    .dark .kbd{ background:#1c1f27; border-color:#374151 }
    /* Donut initial spin */
    #donutPipeline.spin-in{ animation: donutSpin 1.1s ease-out 1; transform-origin:center }
    @keyframes donutSpin{ from{ transform:rotate(-180deg) } to{ transform:rotate(0) } }
  </style>
</head>
<body class="h-full bg-ink-50 dark:bg-ink-900 text-ink-900 dark:text-ink-100">

  <div class="min-h-screen w-full flex">
    <!-- SIDEBAR: PC visible (static), Mobile off-canvas -->
    <aside id="sidebar"
      class="w-72 bg-white dark:bg-ink-800 border-r border-ink-200 dark:border-ink-700 flex flex-col
             fixed inset-y-0 left-0 z-40 transform transition-transform duration-300 -translate-x-full
             lg:static lg:translate-x-0">

      <div class="px-4 py-4 border-b border-ink-200 dark:border-ink-700 flex items-center justify-between">
        <div class="flex items-center gap-3">
          <div class="h-10 w-10 rounded-xl bg-primary-600 text-white flex items-center justify-center font-bold">ux</div>
          <div>
            <div class="font-semibold leading-5">Uxerflow Inc.</div>
            <div class="text-xs text-ink-500">Free Plan</div>
          </div>
        </div>
        <!-- Close (mobile) -->
        <button id="sbClose" class="p-2 rounded-lg hover:bg-ink-100 dark:hover:bg-ink-700 lg:hidden" aria-label="Close menu">
          <i data-lucide="x" class="h-5 w-5"></i>
        </button>
      </div>

      <nav class="flex-1 overflow-y-auto px-2 py-3">
        <div>
          <a class="flex items-center gap-3 px-3 py-2 rounded-lg bg-primary-50 dark:bg-ink-700 text-primary-700 dark:text-ink-100 font-medium" href="#">
            <i data-lucide="layout-dashboard" class="h-5 w-5"></i> Dashboard
          </a>
          <a class="mt-1 flex items-center justify-between px-3 py-2 rounded-lg hover:bg-ink-100 dark:hover:bg-ink-700" href="#">
            <span class="flex items-center gap-3"><i data-lucide="search" class="h-5 w-5"></i> Search</span>
            <span class="kbd px-1.5 py-0.5 text-[10px] rounded">K</span>
          </a>
          <a class="mt-1 flex items-center justify-between px-3 py-2 rounded-lg hover:bg-ink-100 dark:hover:bg-ink-700" href="#">
            <span class="flex items-center gap-3"><i data-lucide="bell" class="h-5 w-5"></i> Updates</span>
            <span class="inline-flex items-center justify-center h-5 min-w-[20px] rounded-full bg-primary-100 dark:bg-ink-700 text-primary-700 dark:text-ink-100 text-[11px] px-1.5"><span data-anim>24</span></span>
          </a>
          <a class="mt-1 flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-ink-100 dark:hover:bg-ink-700" href="#"><i data-lucide="message-square" class="h-5 w-5"></i> Message</a>
          <a class="mt-1 flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-ink-100 dark:hover:bg-ink-700" href="#"><i data-lucide="settings-2" class="h-5 w-5"></i> Settings</a>
        </div>

        <div class="mt-6 text-[11px] uppercase tracking-wide text-ink-500 px-3">Records</div>
        <div class="mt-2">
          <a class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-ink-100 dark:hover:bg-ink-700" href="#"><i data-lucide="users" class="h-5 w-5"></i> People</a>
          <a class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-ink-100 dark:hover:bg-ink-700" href="#"><i data-lucide="user-round" class="h-5 w-5"></i> Teams</a>
          <a class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-ink-100 dark:hover:bg-ink-700" href="#"><i data-lucide="building-2" class="h-5 w-5"></i> Companies</a>
        </div>

        <div class="mt-6 flex items-center justify-between px-3">
          <div class="text-[11px] uppercase tracking-wide text-ink-500">Workspace</div>
          <button class="p-1 rounded-md hover:bg-ink-100 dark:hover:bg-ink-700"><i data-lucide="plus" class="h-4 w-4"></i></button>
        </div>
        <div class="mt-2">
          <a class="flex items-center justify-between px-3 py-2 rounded-lg hover:bg-ink-100 dark:hover:bg-ink-700" href="#">
            <span class="flex items-center gap-3"><i data-lucide="sparkles" class="h-5 w-5 text-primary-600"></i> Campaigns</span><span class="text-ink-500 text-sm"><span data-anim>5</span></span>
          </a>
          <a class="flex items-center justify-between px-3 py-2 rounded-lg hover:bg-ink-100 dark:hover:bg-ink-700" href="#">
            <span class="flex items-center gap-3"><i data-lucide="handshake" class="h-5 w-5 text-primary-600"></i> Partners</span><span class="text-ink-500 text-sm"><span data-anim>4</span></span>
          </a>
          <a class="flex items-center justify-between px-3 py-2 rounded-lg hover:bg-ink-100 dark:hover:bg-ink-700" href="#">
            <span class="flex items-center gap-3"><i data-lucide="pie-chart" class="h-5 w-5 text-primary-600"></i> Marketing</span><span class="text-ink-500 text-sm"><span data-anim>2</span></span>
          </a>
        </div>
      </nav>

      <div class="mt-auto px-3 py-3 border-t border-ink-200 dark:border-ink-700">
        <a class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-ink-100 dark:hover:bg-ink-700" href="#"><i data-lucide="user-plus" class="h-5 w-5"></i> Invite teams</a>
        <a class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-ink-100 dark:hover:bg-ink-700" href="#"><i data-lucide="thumbs-up" class="h-5 w-5"></i> Feedback</a>
        <a class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-ink-100 dark:hover:bg-ink-700" href="#"><i data-lucide="book-open-text" class="h-5 w-5"></i> Help & docs</a>
      </div>
    </aside>

    <!-- OVERLAY (mobile) -->
    <div id="sbOverlay" class="fixed inset-0 bg-black/40 z-30 hidden lg:hidden"></div>

    <!-- MAIN -->
    <main class="flex-1 min-w-0">
      <div class="px-6 pt-6">
        <div class="flex items-center justify-between">
          <div class="flex items-center gap-3">
            <!-- Hamburger (mobile only) -->
            <button id="sbOpen" class="p-2 rounded-lg hover:bg-ink-100 dark:hover:bg-ink-800 lg:hidden" aria-label="Open menu">
              <i data-lucide="menu" class="h-6 w-6"></i>
            </button>
            <h1 class="text-[22px] font-semibold tracking-tight">Dashboard</h1>
          </div>

          <div class="flex items-center gap-3">
            <!-- Theme Switch -->
            <label class="flex items-center gap-2 select-none">
              <span class="text-sm text-ink-600 dark:text-ink-300 hidden sm:inline">Light</span>
              <span class="relative inline-flex items-center">
                <input id="themeSwitch" type="checkbox" class="peer sr-only">
                <div class="w-11 h-6 rounded-full bg-ink-200 peer-checked:bg-primary-600 transition"></div>
                <span class="pointer-events-none absolute left-1 h-4 w-4 rounded-full bg-white shadow translate-x-0 peer-checked:translate-x-5 transition"></span>
              </span>
              <span class="text-sm text-ink-600 dark:text-ink-300 hidden sm:inline">Dark</span>
            </label>

            <button class="hidden sm:inline-flex items-center gap-2 px-3 py-2 rounded-lg border border-ink-200 dark:border-ink-700 bg-white dark:bg-ink-800 hover:bg-ink-100 dark:hover:bg-ink-700">
              <i data-lucide="share-2" class="h-4 w-4"></i> Share
            </button>
            <div class="hidden md:flex -space-x-2">
              <img class="h-8 w-8 rounded-full ring-2 ring-white dark:ring-ink-800" src="https://i.pravatar.cc/64?img=32" alt="T1">
              <img class="h-8 w-8 rounded-full ring-2 ring-white dark:ring-ink-800" src="https://i.pravatar.cc/64?img=15" alt="T2">
              <img class="h-8 w-8 rounded-full ring-2 ring-white dark:ring-ink-800" src="https://i.pravatar.cc/64?img=5" alt="T3">
            </div>
            <button class="p-2 rounded-lg border border-ink-200 dark:border-ink-700 bg-white dark:bg-ink-800 hover:bg-ink-100 dark:hover:bg-ink-700">
              <i data-lucide="plus" class="h-5 w-5"></i>
            </button>
          </div>
        </div>

        <!-- Garis pemisah -->
        <div class="mt-4 border-b border-ink-200 dark:border-ink-700"></div>

        <!-- Tabs + Actions (mobile simetris) -->
        <div class="mt-4 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
          <div class="grid grid-cols-2 sm:inline-flex items-center bg-white dark:bg-ink-800 border border-ink-200 dark:border-ink-700 rounded-xl p-1 w-full sm:w-auto gap-1 sm:gap-0">
            <button class="col-span-1 text-center px-3 py-2 rounded-lg font-medium bg-primary-50 dark:bg-ink-700 text-primary-700 dark:text-ink-100" aria-pressed="true">Overview</button>
            <button class="col-span-1 text-center px-3 py-2 rounded-lg font-medium text-ink-600 dark:text-ink-200 hover:bg-ink-100 dark:hover:bg-ink-700" aria-pressed="false">Sales Order</button>
          </div>
          <div class="grid grid-cols-2 sm:flex gap-2 w-full sm:w-auto">
            <button class="inline-flex items-center justify-center gap-2 px-3 py-2 rounded-lg border border-ink-200 dark:border-ink-700 bg-white dark:bg-ink-800 hover:bg-ink-100 dark:hover:bg-ink-700">
              <i data-lucide="sliders-horizontal" class="h-4 w-4"></i> <span class="hidden sm:inline">Filter</span>
            </button>
            <button class="inline-flex items-center justify-center gap-2 px-3 py-2 rounded-lg bg-primary-600 text-white hover:bg-primary-700">
              <i data-lucide="upload" class="h-4 w-4"></i> <span class="hidden sm:inline">Export</span>
            </button>
          </div>
        </div>
      </div>

      <!-- KPI CARDS -->
      <section class="px-6 mt-5 grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-4">
        <article class="bg-white dark:bg-ink-800 border border-ink-200 dark:border-ink-700 rounded-2xl shadow-card p-4">
          <div class="flex items-start justify-between">
            <div class="text-sm font-medium text-ink-600 dark:text-ink-200">Active Sales</div>
            <button class="p-1.5 rounded-lg hover:bg-ink-100 dark:hover:bg-ink-700"><i data-lucide="clock" class="h-4 w-4 text-ink-500"></i></button>
          </div>
          <div class="mt-2 text-[28px] font-bold tracking-tight"><span data-anim>$24,064</span></div>
          <div class="mt-1 flex items-center gap-2 text-sm text-ink-500">
            <span>vs. Last periode</span>
            <span class="inline-flex items-center gap-1 rounded-full bg-success-50 text-success-500 px-1.5 py-0.5 text-[12px]">
              <i data-lucide="arrow-up-right" class="h-3.5 w-3.5"></i> <span data-anim>27.4%</span>
            </span>
          </div>
        </article>

        <article class="bg-white dark:bg-ink-800 border border-ink-200 dark:border-ink-700 rounded-2xl shadow-card p-4">
          <div class="flex items-start justify-between">
            <div class="text-sm font-medium text-ink-600 dark:text-ink-200">Product Revenue</div>
            <button class="p-1.5 rounded-lg hover:bg-ink-100 dark:hover:bg-ink-700"><i data-lucide="calendar" class="h-4 w-4 text-ink-500"></i></button>
          </div>
          <div class="mt-2 text-[28px] font-bold tracking-tight"><span data-anim>$15,490</span></div>
          <div class="mt-1 flex items-center gap-2 text-sm text-ink-500">
            <span>vs. Last periode</span>
            <span class="inline-flex items-center gap-1 rounded-full bg-success-50 text-success-500 px-1.5 py-0.5 text-[12px]">
              <i data-lucide="arrow-up-right" class="h-3.5 w-3.5"></i> <span data-anim>32.5%</span>
            </span>
          </div>
        </article>

        <article class="bg-white dark:bg-ink-800 border border-ink-200 dark:border-ink-700 rounded-2xl shadow-card p-4">
          <div class="flex items-start justify-between">
            <div class="text-sm font-medium text-ink-600 dark:text-ink-200">Total Deals</div>
            <button class="p-1.5 rounded-lg hover:bg-ink-100 dark:hover:bg-ink-700"><i data-lucide="users" class="h-4 w-4 text-ink-500"></i></button>
          </div>
          <div class="mt-2 text-[28px] font-bold tracking-tight"><span data-anim>827</span></div>
          <div class="mt-1 flex items-center gap-2 text-sm text-ink-500">
            <span>vs. Last periode</span>
            <span class="inline-flex items-center gap-1 rounded-full bg-danger-50 text-danger-500 px-1.5 py-0.5 text-[12px]">
              <i data-lucide="arrow-down-right" class="h-3.5 w-3.5"></i> <span data-anim>18.9%</span>
            </span>
          </div>
        </article>

        <article class="bg-white dark:bg-ink-800 border border-ink-200 dark:border-ink-700 rounded-2xl shadow-card p-4">
          <div class="flex items-start justify-between">
            <div class="text-sm font-medium text-ink-600 dark:text-ink-200">Reply Rate</div>
            <button class="p-1.5 rounded-lg hover:bg-ink-100 dark:hover:bg-ink-700"><i data-lucide="zap" class="h-4 w-4 text-ink-500"></i></button>
          </div>
          <div class="mt-2 text-[28px] font-bold tracking-tight"><span data-anim>86,5%</span></div>
          <div class="mt-1 flex items-center gap-2 text-sm text-ink-500">
            <span>vs. Last periode</span>
            <span class="inline-flex items-center gap-1 rounded-full bg-success-50 text-success-500 px-1.5 py-0.5 text-[12px]">
              <i data-lucide="arrow-up-right" class="h-3.5 w-3.5"></i> <span data-anim>14.7%</span>
            </span>
          </div>
        </article>
      </section>

      <!-- CHARTS (Average Ticket + Revenue) -->
      <section class="px-6 mt-5 grid grid-cols-1 xl:grid-cols-3 gap-4">
        <!-- Average Ticket -->
        <article class="xl:col-span-2 bg-white dark:bg-ink-800 border border-ink-200 dark:border-ink-700 rounded-2xl shadow-card p-4">
          <div class="flex flex-wrap items-center justify-between gap-3">
            <h3 class="font-semibold">Average Ticket</h3>
            <div class="flex items-center gap-3">
              <div id="ticketLegend" class="flex items-center gap-3 text-sm select-none">
                <label class="flex items-center gap-1.5 cursor-pointer">
                  <span class="inline-block h-3 w-3 rounded-full bg-primary-600"></span> Checkout
                </label>
                <label class="flex items-center gap-1.5 cursor-pointer">
                  <span class="inline-block h-3 w-3 rounded-full bg-primary-300"></span> Viewing
                </label>
              </div>
              <div class="relative">
                <button id="btnPeriod1" class="inline-flex items-center gap-2 px-2.5 py-1.5 rounded-lg border border-ink-200 dark:border-ink-700 hover:bg-ink-100 dark:hover:bg-ink-700 text-sm">
                  Last 6 month <i data-lucide="chevron-down" class="h-4 w-4"></i>
                </button>
                <div id="menuPeriod1" class="hidden absolute right-0 mt-1 w-40 bg-white dark:bg-ink-800 border border-ink-200 dark:border-ink-700 rounded-xl shadow-card z-10">
                  <button class="w-full text-left px-3 py-2 hover:bg-ink-100 dark:hover:bg-ink-700 text-sm">Last 3 month</button>
                  <button class="w-full text-left px-3 py-2 hover:bg-ink-100 dark:hover:bg-ink-700 text-sm">Last 6 month</button>
                  <button class="w-full text-left px-3 py-2 hover:bg-ink-100 dark:hover:bg-ink-700 text-sm">This year</button>
                </div>
              </div>
            </div>
          </div>
          <div class="mt-3 h-[320px]"><canvas id="barTicket"></canvas></div>
        </article>

        <!-- Revenue -->
        <article class="bg-white dark:bg-ink-800 border border-ink-200 dark:border-ink-700 rounded-2xl shadow-card p-4">
          <div class="flex items-center justify-between">
            <h3 class="font-semibold">Revenue</h3>
            <div class="relative">
              <button id="btnPeriod2" class="inline-flex items-center gap-2 px-2.5 py-1.5 rounded-lg border border-ink-200 dark:border-ink-700 hover:bg-ink-100 dark:hover:bg-ink-700 text-sm">
                Last Week <i data-lucide="chevron-down" class="h-4 w-4"></i>
              </button>
              <div id="menuPeriod2" class="hidden absolute right-0 mt-1 w-40 bg-white dark:bg-ink-800 border border-ink-200 dark:border-ink-700 rounded-xl shadow-card z-10">
                <button class="w-full text-left px-3 py-2 hover:bg-ink-100 dark:hover:bg-ink-700 text-sm">Last Week</button>
                <button class="w-full text-left px-3 py-2 hover:bg-ink-100 dark:hover:bg-ink-700 text-sm">Last Month</button>
              </div>
            </div>
          </div>
          <div class="mt-1">
            <div class="text-[26px] font-bold"><span data-anim>$8,247</span></div>
            <div class="mt-1 flex items-center gap-2 text-sm text-ink-500">
              <span>vs. Last periode</span>
              <span class="inline-flex items-center gap-1 rounded-full bg-success-50 text-success-500 px-1.5 py-0.5 text-[12px]">
                <i data-lucide="arrow-up-right" class="h-3.5 w-3.5"></i> <span data-anim>27.3%</span>
              </span>
            </div>
          </div>
          <div class="mt-4 h-[260px]"><canvas id="lineRevenue"></canvas></div>
          <div class="grid grid-cols-7 text-xs text-ink-500 mt-2">
            <div class="text-center">Sun</div><div class="text-center">Mon</div><div class="text-center">Tue</div>
            <div class="text-center">Wed</div><div class="text-center">Thu</div><div class="text-center">Fri</div><div class="text-center">Sat</div>
          </div>
        </article>
      </section>

      <!-- LIST & PIPELINE -->
      <section class="px-6 mt-5 grid grid-cols-1 xl:grid-cols-3 gap-4 mb-10">
        <!-- List of Deals -->
        <article class="xl:col-span-2 bg-white dark:bg-ink-800 border border-ink-200 dark:border-ink-700 rounded-2xl shadow-card">
          <div class="p-4 flex items-center justify-between">
            <h3 class="font-semibold">List of Deals</h3>
            <a href="#" class="text-sm text-primary-700 dark:text-primary-400 hover:underline">See all</a>
          </div>
          <div class="border-t border-ink-200 dark:border-ink-700"></div>
          <div class="p-4 space-y-2">
            <!-- ROW 1 -->
            <div class="grid grid-cols-12 gap-y-1 items-center bg-ink-50/60 dark:bg-ink-900/40 rounded-xl px-2 py-2">
              <div class="col-span-8 xl:col-span-5 min-w-0">
                <div class="font-medium truncate">Web Development</div>
                <div class="text-xs text-ink-500">Jan 18, 2023</div>
              </div>
              <div class="col-span-4 text-right xl:hidden">
                <div class="font-medium"><span data-anim>$40,000</span></div>
                <div class="text-[10px] text-ink-500">USD</div>
              </div>
              <div class="col-span-8 xl:col-span-3 flex items-center gap-2 min-w-0">
                <img class="h-6 w-6 rounded-full shrink-0" src="https://i.pravatar.cc/40?img=20" alt="Thuram">
                <div class="text-sm truncate">Thuram Marcus</div>
              </div>
              <div class="col-span-4 xl:col-span-2">
                <span class="inline-flex items-center gap-1 text-xs px-2 py-1 rounded-full bg-yellow-50 text-yellow-700 border border-yellow-200">
                  <span class="inline-block h-1.5 w-1.5 rounded-full bg-yellow-500"></span> On Review
                </span>
              </div>
              <div class="hidden xl:block xl:col-span-2 text-right">
                <div class="font-medium"><span data-anim>$40,000</span></div>
                <div class="text-[10px] text-ink-500">USD</div>
              </div>
            </div>

            <!-- ROW 2 -->
            <div class="grid grid-cols-12 gap-y-1 items-center bg-white dark:bg-ink-800 rounded-xl px-2 py-2 border border-ink-200 dark:border-ink-700">
              <div class="col-span-8 xl:col-span-5 min-w-0">
                <div class="font-medium truncate">Mobile App Design</div>
                <div class="text-xs text-ink-500">Jan 25, 2023</div>
              </div>
              <div class="col-span-4 text-right xl:hidden">
                <div class="font-medium"><span data-anim>$12,300</span></div>
                <div class="text-[10px] text-ink-500">USD</div>
              </div>
              <div class="col-span-8 xl:col-span-3 flex items-center gap-2 min-w-0">
                <img class="h-6 w-6 rounded-full shrink-0" src="https://i.pravatar.cc/40?img=12" alt="Sosa">
                <div class="text-sm truncate">Lamine Sosa</div>
              </div>
              <div class="col-span-4 xl:col-span-2">
                <span class="inline-flex items-center gap-1 text-xs px-2 py-1 rounded-full bg-primary-50 dark:bg-ink-700 text-primary-700 dark:text-ink-100 border border-primary-200 dark:border-ink-600">
                  <span class="inline-block h-1.5 w-1.5 rounded-full bg-primary-600"></span> Discovery
                </span>
              </div>
              <div class="hidden xl:block xl:col-span-2 text-right">
                <div class="font-medium"><span data-anim>$12,300</span></div>
                <div class="text-[10px] text-ink-500">USD</div>
              </div>
            </div>

            <!-- ROW 3 -->
            <div class="grid grid-cols-12 gap-y-1 items-center bg-ink-50/60 dark:bg-ink-900/40 rounded-xl px-2 py-2">
              <div class="col-span-8 xl:col-span-5 min-w-0">
                <div class="font-medium truncate">Consulting Package</div>
                <div class="text-xs text-ink-500">Feb 09, 2023</div>
              </div>
              <div class="col-span-4 text-right xl:hidden">
                <div class="font-medium"><span data-anim>$8,560</span></div>
                <div class="text-[10px] text-ink-500">USD</div>
              </div>
              <div class="col-span-8 xl:col-span-3 flex items-center gap-2 min-w-0">
                <img class="h-6 w-6 rounded-full shrink-0" src="https://i.pravatar.cc/40?img=48" alt="Elena">
                <div class="text-sm truncate">Elena Tan</div>
              </div>
              <div class="col-span-4 xl:col-span-2">
                <span class="inline-flex items-center gap-1 text-xs px-2 py-1 rounded-full bg-green-50 text-green-700 border border-green-200">
                  <span class="inline-block h-1.5 w-1.5 rounded-full bg-green-500"></span> Won
                </span>
              </div>
              <div class="hidden xl:block xl:col-span-2 text-right">
                <div class="font-medium"><span data-anim>$8,560</span></div>
                <div class="text-[10px] text-ink-500">USD</div>
              </div>
            </div>
          </div>
        </article>

        <!-- Sales Pipeline -->
        <article class="bg-white dark:bg-ink-800 border border-ink-200 dark:border-ink-700 rounded-2xl shadow-card p-4">
          <div class="flex items-center justify-between">
            <h3 class="font-semibold">Sales Pipeline</h3>
            <button class="inline-flex items-center gap-2 px-2.5 py-1.5 rounded-lg border border-ink-200 dark:border-ink-700 hover:bg-ink-100 dark:hover:bg-ink-700 text-sm">
              Last Month <i data-lucide="chevron-down" class="h-4 w-4"></i>
            </button>
          </div>
          <div class="mt-4 flex flex-col items-center">
            <div class="h-[240px] w-full">
              <canvas id="donutPipeline" class="spin-in"></canvas>
            </div>

            <!-- Legend dinamis + anim -->
            <div id="pipelineLegend" class="mt-4 grid grid-cols-2 gap-x-6 gap-y-2 text-sm">
              <div class="flex items-center gap-2"><span class="inline-block h-3 w-3 rounded-full bg-primary-600"></span> Won <span class="text-ink-500 dark:text-ink-300">— <span id="wonPct" data-anim>42%</span> (<span id="wonVal" data-anim>42</span>)</span></div>
              <div class="flex items-center gap-2"><span class="inline-block h-3 w-3 rounded-full bg-primary-300"></span> Discovery <span class="text-ink-500 dark:text-ink-300">— <span id="disPct" data-anim>28%</span> (<span id="disVal" data-anim>28</span>)</span></div>
              <div class="flex items-center gap-2"><span class="inline-block h-3 w-3 rounded-full bg-ink-300"></span> Negotiation <span class="text-ink-500 dark:text-ink-300">— <span id="negPct" data-anim>18%</span> (<span id="negVal" data-anim>18</span>)</span></div>
              <div class="flex items-center gap-2"><span class="inline-block h-3 w-3 rounded-full bg-ink-200"></span> Lost <span class="text-ink-500 dark:text-ink-300">— <span id="losPct" data-anim>12%</span> (<span id="losVal" data-anim>12</span>)</span></div>
            </div>
          </div>
        </article>
      </section>
    </main>
  </div>

  <script>
    window.addEventListener('DOMContentLoaded', () => {
      // Render ikon
      lucide.createIcons();

      // ====== Sidebar Mobile (off-canvas) ======
      const sidebar   = document.getElementById('sidebar');
      const sbOverlay = document.getElementById('sbOverlay');
      const sbOpen    = document.getElementById('sbOpen');
      const sbClose   = document.getElementById('sbClose');
      const lgMQL     = window.matchMedia('(min-width:1024px)');

      function resizeCharts(){
        try{ barTicket?.resize(); lineRevenue?.resize(); donutPipeline?.resize(); }catch(e){}
      }

      function openSidebar(){
        sidebar.classList.remove('-translate-x-full');
        sidebar.classList.add('translate-x-0');
        sbOverlay.classList.remove('hidden');
        document.body.classList.add('overflow-hidden');
        setTimeout(resizeCharts, 300);
      }
      function closeSidebar(){
        sidebar.classList.add('-translate-x-full');
        sidebar.classList.remove('translate-x-0');
        sbOverlay.classList.add('hidden');
        document.body.classList.remove('overflow-hidden');
        setTimeout(resizeCharts, 300);
      }
      function syncSidebar(e){
        if (e.matches){ // PC
          sidebar.classList.remove('-translate-x-full');
          sidebar.classList.add('translate-x-0');
          sbOverlay.classList.add('hidden');
          document.body.classList.remove('overflow-hidden');
        } else {        // Mobile
          sidebar.classList.add('-translate-x-full');
          sidebar.classList.remove('translate-x-0');
        }
        resizeCharts();
      }
      sbOpen?.addEventListener('click', openSidebar);
      sbClose?.addEventListener('click', closeSidebar);
      sbOverlay?.addEventListener('click', closeSidebar);
      lgMQL.addEventListener('change', syncSidebar);
      syncSidebar(lgMQL); // set kondisi awal

      // ====== Dropdown helper ======
      function bindDropdown(btnId, menuId){
        const btn = document.getElementById(btnId);
        const menu = document.getElementById(menuId);
        if (!btn || !menu) return;
        btn.addEventListener('click', (e)=>{ e.stopPropagation(); menu.classList.toggle('hidden'); });
        document.addEventListener('click', ()=> menu.classList.add('hidden'));
      }
      bindDropdown('btnPeriod1','menuPeriod1');
      bindDropdown('btnPeriod2','menuPeriod2');

      // ====== THEME (Switch) ======
      const KEY='pref-theme';
      const switchEl = document.getElementById('themeSwitch');
      const isDark = () => document.documentElement.classList.contains('dark');
      function setTheme(mode){
        document.documentElement.classList.toggle('dark', mode==='dark');
        try{ localStorage.setItem(KEY, mode); }catch(e){}
        applyChartThemeSafely(isDark());
      }
      if (switchEl) switchEl.checked = isDark();
      switchEl?.addEventListener('change', ()=> setTheme(switchEl.checked ? 'dark' : 'light'));

      // ====== CHARTS ======
      const T = Chart;
      const ctx1 = document.getElementById('barTicket')?.getContext('2d');
      const ctx2 = document.getElementById('lineRevenue')?.getContext('2d');
      const ctx3 = document.getElementById('donutPipeline')?.getContext('2d');

      let barTicket = null, lineRevenue = null, donutPipeline = null;

      function grad(ctx, from, to){
        const g = ctx.createLinearGradient(0,0,0,300);
        g.addColorStop(0, from); g.addColorStop(1, to); return g;
      }

      // Plugin: background columns (selaras garis revenue)
      const bgColumns = {
        id:'bgColumns',
        beforeDatasetsDraw(chart, args, opts) {
          const {ctx, chartArea:{bottom}, scales:{x,y}} = chart;
          const values = (opts && opts.values) || [];
          const color  = (opts && opts.color)  || 'rgba(125,113,253,0.12)';
          ctx.save(); ctx.fillStyle = color;
          chart.data.labels.forEach((_, i)=>{
            const step = x.getPixelForTick(1)-x.getPixelForTick(0);
            const xPos = x.getPixelForValue(i) - step/4;
            const barW = step/2;
            const yPix = y.getPixelForValue(values[i] ?? 0);
            ctx.fillRect(xPos, yPix, barW, bottom - yPix);
          });
          ctx.restore();
        }
      };

      // Data & Charts
      const months = ['Jan','Feb','Mar','Apr','May','Jun'];
      const dataCheckout = [320,180,280,520,140,410];
      const dataViewing  = [210,120,200,740,110,360];

      if (ctx1){
        barTicket = new T.Chart(ctx1, {
          type:'bar',
          data:{
            labels:months,
            datasets:[
              { label:'Checkout', data:dataCheckout,
                backgroundColor:grad(ctx1,'rgba(109,93,255,1)','rgba(109,93,255,0.22)'),
                borderColor:'#6D5DFF', borderWidth:1, borderRadius:12,
                barThickness:40, maxBarThickness:44, categoryPercentage:0.6, barPercentage:0.9
              },
              { label:'Viewing', data:dataViewing,
                backgroundColor:grad(ctx1,'rgba(186,191,255,1)','rgba(186,191,255,0.22)'),
                borderColor:'#BABFFF', borderWidth:1, borderRadius:12,
                barThickness:40, maxBarThickness:44, categoryPercentage:0.6, barPercentage:0.9
              }
            ]
          },
          options:{
            responsive:true, maintainAspectRatio:false,
            animation:{ duration:1100, easing:'easeOutQuart',
              delay:(ctx)=> (ctx.type==='data' && ctx.mode==='default') ? ctx.dataIndex*70 + ctx.datasetIndex*120 : 0 },
            plugins:{ legend:{ display:false }, tooltip:{ backgroundColor:'#111827', titleColor:'#fff', bodyColor:'#e5e7eb', padding:10, displayColors:true } },
            interaction:{ mode:'index', intersect:false },
            scales:{
              x:{ stacked:true, grid:{ display:false }, ticks:{ color:'#6B7280' } },
              y:{ stacked:true, border:{ display:false }, grid:{ color:'rgba(17,24,39,0.06)' }, ticks:{ color:'#6B7280' } }
            }
          }
        });
      }

      const days       = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
      const bgValues   = [12,24,18,16,22,20,28];
      const lineValues = [18,26,19,17,24,22,31];
      const yMax = Math.max(...bgValues, ...lineValues) + 4;

      if (ctx2){
        lineRevenue = new T.Chart(ctx2, {
          type:'line',
          data:{ labels:days, datasets:[{ label:'Revenue', data:lineValues, borderColor:'#6D5DFF', borderWidth:2.5, pointRadius:0, tension:0.35, fill:false }] },
          options:{
            responsive:true, maintainAspectRatio:false,
            animation:{ duration:1100, easing:'easeOutQuart', delay:(ctx)=> (ctx.type==='data' && ctx.mode==='default') ? ctx.dataIndex*80 : 0 },
            plugins:{
              legend:{ display:false },
              tooltip:{ backgroundColor:'#111827', titleColor:'#fff', bodyColor:'#e5e7eb', padding:10 },
              bgColumns:{ color:'rgba(109,93,255,0.12)', values:bgValues }
            },
            scales:{
              x:{ grid:{ display:false }, ticks:{ display:false } },
              y:{ min:0, suggestedMax:yMax, grid:{ color:'rgba(17,24,39,0.06)' }, ticks:{ display:false } }
            }
          },
          plugins:[bgColumns]
        });
      }

      const donutData = [42,28,18,12];
      if (ctx3){
        donutPipeline = new T.Chart(ctx3, {
          type:'doughnut',
          data:{ labels:['Won','Discovery','Negotiation','Lost'],
            datasets:[{ data:donutData, backgroundColor:['#6D5DFF','#BABFFF','#D9DDE7','#E6E8F0'], borderWidth:0, hoverOffset:3 }] },
          options:{
            responsive:true, maintainAspectRatio:false, cutout:'68%',
            animation:{ duration:1100, animateRotate:true, easing:'easeOutQuart' },
            plugins:{ legend:{ display:false }, tooltip:{ backgroundColor:'#111827', titleColor:'#fff', bodyColor:'#e5e7eb' } }
          }
        });

        // Center text donut
        const centerText = {
          id:'centerText',
          afterDatasetsDraw(chart){
            const m = chart.getDatasetMeta(0); if(!m || !m.data || !m.data[0]) return;
            const {ctx} = chart, p = m.data[0];
            ctx.save(); ctx.font='600 14px Inter'; ctx.fillStyle = isDark() ? '#D1D5DB' : '#6B7280'; ctx.textAlign='center';
            ctx.fillText('Last Month', p.x, p.y+6); ctx.restore();
          }
        };
        donutPipeline.config.plugins.push(centerText);
        donutPipeline.update();
        setTimeout(()=> document.getElementById('donutPipeline').classList.remove('spin-in'), 1200);
      }

      // Legend Pipeline dinamis (set nilai awal agar anim target tepat)
      (function fillPipelineLegend(){
        const t = donutData.reduce((a,b)=>a+b,0);
        const pct = v => Math.round((v/t)*100);
        const set = (id, val)=>{ const el=document.getElementById(id); if(el) el.textContent = val; };
        set('wonVal', donutData[0]); set('wonPct', pct(donutData[0])+'%');
        set('disVal', donutData[1]); set('disPct', pct(donutData[1])+'%');
        set('negVal', donutData[2]); set('negPct', pct(donutData[2])+'%');
        set('losVal', donutData[3]); set('losPct', pct(donutData[3])+'%');
      })();

      // Tema -> chart
      function applyChartThemeSafely(dark){
        const tick = dark ? '#D1D5DB' : '#6B7280';
        const grid = dark ? 'rgba(255,255,255,0.10)' : 'rgba(17,24,39,0.06)';
        if(barTicket){ barTicket.options.scales.x.ticks.color = tick; barTicket.options.scales.y.ticks.color = tick; barTicket.options.scales.y.grid.color  = grid; barTicket.update(); }
        if(lineRevenue){ lineRevenue.options.scales.y.grid.color = grid; lineRevenue.options.plugins.bgColumns.color = dark ? 'rgba(109,93,255,0.22)' : 'rgba(109,93,255,0.12)'; lineRevenue.update(); }
        if(donutPipeline){ donutPipeline.update(); }
      }
      window.applyChartThemeSafely = applyChartThemeSafely;

      // Toggle dataset (legend Average Ticket)
      document.querySelectorAll('#ticketLegend label').forEach((lbl, idx)=>{
        lbl.addEventListener('click',()=>{
          if(!barTicket) return;
          const meta = barTicket.getDatasetMeta(idx);
          meta.hidden = meta.hidden === null ? !barTicket.data.datasets[idx].hidden : null;
          barTicket.update();
        });
      });

      // ====== COUNT-UP ANIMATION (semua angka, responsif, sekali jalan) ======
      function parseFormat(text){
        const s = text.trim();
        const hasPct = /%$/.test(s);
        const hasDollar = /^\$/.test(s);
        // numeric part only
        const numericPart = s.replace(/[^\d,.\-]/g,'');
        let decimals = 0;
        const m = numericPart.match(/[.,]([0-9]+)(?!.*[.,][0-9]+)/); // desimal terakhir
        if (m) decimals = m[1].length;
        // locale heuristik: jika ada koma tapi tidak ada titik -> id-ID (koma desimal)
        let locale = 'en-US';
        if (numericPart.includes(',') && !numericPart.includes('.')) locale = 'id-ID';
        return { type: hasPct ? 'percent' : hasDollar ? 'currency' : 'number', decimals, locale };
      }
      function parseTarget(text){
        let s = text.replace(/[^\d,.\-]/g,'');
        if (s.includes(',') && !s.includes('.')){ // decimal pakai koma
          s = s.replace(/\./g,''); // hapus ribuan titik jika ada
          s = s.replace(',', '.');
        } else {
          s = s.replace(/,/g,'');
        }
        const n = parseFloat(s);
        return isNaN(n) ? 0 : n;
      }
      function makeFormatter(orig){
        const f = parseFormat(orig);
        if (f.type === 'currency'){
          const nf = new Intl.NumberFormat('en-US', { style:'currency', currency:'USD', minimumFractionDigits:f.decimals, maximumFractionDigits:f.decimals });
          return v => nf.format(v);
        }
        const nf = new Intl.NumberFormat(f.locale, { minimumFractionDigits:f.decimals, maximumFractionDigits:f.decimals });
        if (f.type === 'percent'){
          return v => nf.format(v) + '%';
        }
        return v => nf.format(v);
      }
      function easeOutCubic(t){ return 1 - Math.pow(1 - t, 3); }

      function animateNumber(el, duration=1100){
        const orig = (el.dataset.orig ?? el.textContent).trim();
        el.dataset.orig = orig;
        const formatter = makeFormatter(orig);
        const target = parseTarget(orig);
        const start = 0;
        const startTime = performance.now();
        const decimals = parseFormat(orig).decimals;

        function frame(now){
          const t = Math.min(1, (now - startTime) / duration);
          const eased = easeOutCubic(t);
          let val = start + (target - start) * eased;
          const pow = Math.pow(10, decimals);
          val = Math.round(val * pow) / pow; // hindari jitter float
          el.textContent = formatter(val);
          if (t < 1) requestAnimationFrame(frame);
          else el.textContent = formatter(target); // pastikan berakhir tepat
        }
        requestAnimationFrame(frame);
      }

      function initCounters(){
        const els = document.querySelectorAll('[data-anim]');
        const io = new IntersectionObserver((entries)=>{
          entries.forEach(entry=>{
            if (entry.isIntersecting){
              const el = entry.target;
              if (el.dataset.animated) { io.unobserve(el); return; }
              el.dataset.animated = '1';
              animateNumber(el);
              io.unobserve(el);
            }
          });
        }, {threshold: 0.35});
        els.forEach(el=> io.observe(el));
      }

      // Jalankan setelah legend pipeline di-set agar target benar
      initCounters();
    });
  </script>
</body>
</html>
